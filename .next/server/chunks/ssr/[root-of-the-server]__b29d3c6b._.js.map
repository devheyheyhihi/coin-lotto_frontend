{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 37, "column": 0}, "map": {"version":3,"sources":["file:///Users/sinseonghyeon/Documents/GitHub/01-blockchain-projects/maxpia-project/coin_lotto/frontend/src/app/history/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport Link from 'next/link';\n\n// Extends the window object to use a browser wallet provider like MetaMask.\ndeclare global {\n  interface Window {\n    ethereum?: any;\n  }\n}\n\nconst API_BASE_URL = 'http://localhost:3001';\n\ninterface HistoryItem {\n    roundNumber: number; // This is now the global_round_id\n    roomName: string;\n    ticketPrice: string;\n    wasWinner: boolean;\n}\n\nexport default function HistoryPage() {\n    const [account, setAccount] = useState<string | null>(null);\n    const [history, setHistory] = useState<HistoryItem[]>([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const fetchHistory = useCallback(async (currentAccount: string) => {\n        if (!currentAccount) return;\n        setIsLoading(true);\n        setError(null);\n        try {\n            const response = await fetch(`${API_BASE_URL}/user-history/${currentAccount}`);\n            if (!response.ok) {\n                const errorData = await response.json();\n                throw new Error(errorData.message || 'Failed to fetch history.');\n            }\n            const data = await response.json();\n            setHistory(data.history || []);\n        } catch (err: any) {\n            setError(err.message);\n            setHistory([]);\n        } finally {\n            setIsLoading(false);\n        }\n    }, []);\n    \n    const connectWallet = async () => {\n        if (typeof window.ethereum !== 'undefined') {\n            try {\n                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });\n                setAccount(accounts[0]);\n                fetchHistory(accounts[0]);\n            } catch (err) {\n                setError('Failed to connect wallet.');\n            }\n        } else {\n            setError('Please install MetaMask.');\n        }\n    };\n\n    useEffect(() => {\n        const handleAccountsChanged = (accounts: string[]) => {\n            const newAccount = accounts.length > 0 ? accounts[0] : null;\n            setAccount(newAccount);\n            if (newAccount) {\n                fetchHistory(newAccount);\n            } else {\n                setHistory([]);\n            }\n        };\n\n        if (window.ethereum) {\n            window.ethereum.on('accountsChanged', handleAccountsChanged);\n            (async () => {\n                const accounts = await window.ethereum.request({ method: 'eth_accounts' });\n                handleAccountsChanged(accounts);\n            })();\n            return () => {\n                window.ethereum.removeListener('accountsChanged', handleAccountsChanged);\n            };\n        }\n    }, [fetchHistory]);\n\n    return (\n        <main className=\"flex min-h-screen flex-col items-center justify-center bg-gray-900 text-white p-4\">\n            <div className=\"absolute top-5 left-5\">\n                <Link href=\"/\" className=\"text-blue-400 hover:underline\">‚Üê Back to Lotto</Link>\n            </div>\n\n            <div className=\"w-full max-w-2xl text-center\">\n                <h1 className=\"text-5xl font-bold mb-8\">My History</h1>\n                \n                {!account ? (\n                    <button onClick={connectWallet} className=\"px-8 py-4 bg-blue-600 text-white font-bold text-2xl rounded-lg hover:bg-blue-500\">\n                        Connect Wallet to View History\n                    </button>\n                ) : (\n                    <div className=\"space-y-4\">\n                        {isLoading ? (\n                            <div className=\"w-10 h-10 border-4 border-yellow-400 border-t-transparent rounded-full animate-spin mx-auto\"></div>\n                        ) : error ? (\n                            <p className=\"text-red-500\">{error}</p>\n                        ) : history.length > 0 ? (\n                            <div className=\"bg-gray-800 rounded-lg p-4 max-h-96 overflow-y-auto\">\n                                <ul className=\"space-y-3\">\n                                    {history.map((item, index) => (\n                                        <li key={index} className=\"bg-gray-800 p-4 rounded-md flex justify-between items-center\">\n                                            <div>\n                                                <p className=\"text-lg font-bold\">\n                                                    Global Round <span className=\"text-yellow-400\">#{item.roundNumber}</span> - <span className=\"text-blue-400\">{item.roomName}</span>\n                                                </p>\n                                                <p className=\"text-sm text-gray-400\">Ticket Price: {item.ticketPrice} USDT</p>\n                                            </div>\n                                            {item.wasWinner && (\n                                                <span className=\"text-lg font-bold bg-yellow-500 text-black px-3 py-1 rounded-full\">\n                                                    üéâ WINNER\n                                                </span>\n                                            )}\n                                        </li>\n                                    ))}\n                                </ul>\n                            </div>\n                        ) : (\n                            <p className=\"text-gray-500\">You have not participated in any rounds yet.</p>\n                        )}\n                    </div>\n                )}\n            </div>\n        </main>\n    );\n} "],"names":[],"mappings":"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","debugId":null}}]
}